<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List Comprehensive Test</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            margin: 0; 
            background: #f5f5f5;
        }
        .test-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 350px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 10000;
            max-height: 80vh;
            overflow-y: auto;
        }
        .test-header {
            background: #007bff;
            color: white;
            padding: 12px 15px;
            border-radius: 8px 8px 0 0;
            font-weight: 600;
        }
        .test-content {
            padding: 15px;
        }
        .test-section {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 4px;
            background: #fafafa;
        }
        .test-section h4 {
            margin: 0 0 8px 0;
            font-size: 14px;
            color: #333;
        }
        .test-item {
            display: flex;
            align-items: center;
            margin: 4px 0;
            font-size: 13px;
        }
        .status-icon {
            margin-right: 8px;
            font-weight: bold;
        }
        .status-pass { color: #28a745; }
        .status-fail { color: #dc3545; }
        .status-warn { color: #ffc107; }
        .status-info { color: #17a2b8; }
        .error-list {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            padding: 8px;
            margin-top: 8px;
            font-size: 12px;
            color: #721c24;
        }
        .error-list ul {
            margin: 0;
            padding-left: 16px;
        }
        .storage-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 4px;
            padding: 8px;
            margin-top: 8px;
            font-size: 12px;
        }
        #refresh-test {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
        }
        #toggle-panel {
            position: fixed;
            top: 10px;
            right: 370px;
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            z-index: 10001;
        }
        .test-panel.hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Test Panel -->
    <button id="toggle-panel">Toggle Test Panel</button>
    <div class="test-panel" id="test-panel">
        <div class="test-header">
            Todo App Test Results
        </div>
        <div class="test-content">
            <div class="test-section">
                <h4>Core Functionality</h4>
                <div id="core-tests"></div>
            </div>
            
            <div class="test-section">
                <h4>localStorage Storage</h4>
                <div id="storage-tests"></div>
            </div>
            
            <div class="test-section">
                <h4>UI Components</h4>
                <div id="ui-tests"></div>
            </div>
            
            <div class="test-section">
                <h4>Task Operations</h4>
                <div id="task-tests"></div>
            </div>
            
            <div id="errors-section" class="test-section" style="display: none;">
                <h4>Errors Found</h4>
                <div class="error-list">
                    <ul id="error-list"></ul>
                </div>
            </div>
            
            <button id="refresh-test">Run Tests Again</button>
        </div>
    </div>

    <!-- Include the original app -->
    <script>
        // Override console.log to capture output
        const originalConsoleLog = console.log;
        const originalConsoleWarn = console.warn;
        const originalConsoleError = console.error;
        
        window.testLogs = [];
        
        console.log = function(...args) {
            window.testLogs.push({type: 'log', args});
            originalConsoleLog.apply(console, args);
        };
        
        console.warn = function(...args) {
            window.testLogs.push({type: 'warn', args});
            originalConsoleWarn.apply(console, args);
        };
        
        console.error = function(...args) {
            window.testLogs.push({type: 'error', args});
            originalConsoleError.apply(console, args);
        };
    </script>

    <!-- Load all the CSS -->
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/layouts/grid.css">
    <link rel="stylesheet" href="css/layouts/responsive.css">
    <link rel="stylesheet" href="css/components/header.css">
    <link rel="stylesheet" href="css/components/task-form.css">
    <link rel="stylesheet" href="css/components/task-item.css">
    <link rel="stylesheet" href="css/components/buttons.css">
    <link rel="stylesheet" href="css/components/modal.css">
    <link rel="stylesheet" href="css/components/notification.css">
    <link rel="stylesheet" href="css/themes/light.css">
    <link rel="stylesheet" href="css/themes/dark.css">

    <!-- Copy of the main app content -->
    <div class="app" id="app">
        <header class="app__header" role="banner">
            <div class="header">
                <div class="header__brand">
                    <h1 class="header__title">Todo List Test</h1>
                    <span class="header__subtitle">Comprehensive Testing</span>
                </div>
            </div>
        </header>
        
        <aside class="app__sidebar" id="sidebar" role="complementary">
            <div class="sidebar">
                <h2 class="sidebar__title">Filters</h2>
                
                <section class="sidebar__section">
                    <h3 class="sidebar__section-title">Search</h3>
                    <div class="search-bar">
                        <input type="search" id="search-input" class="search-bar__input" placeholder="Search tasks...">
                    </div>
                </section>
                
                <section class="sidebar__section">
                    <h3 class="sidebar__section-title">Status</h3>
                    <div class="filter-buttons">
                        <button type="button" class="btn btn--filter btn--filter-active" data-filter="all">
                            All <span class="filter-count" data-count="all">0</span>
                        </button>
                        <button type="button" class="btn btn--filter" data-filter="active">
                            Active <span class="filter-count" data-count="active">0</span>
                        </button>
                        <button type="button" class="btn btn--filter" data-filter="completed">
                            Completed <span class="filter-count" data-count="completed">0</span>
                        </button>
                    </div>
                </section>
            </div>
        </aside>
        
        <main class="app__main" id="main-content" role="main">
            <div class="main-content">
                <section class="task-form-section">
                    <form class="task-form" id="task-form">
                        <div class="task-form__input-group">
                            <label for="task-input" class="task-form__label">What needs to be done?</label>
                            <div class="task-form__input-wrapper">
                                <input type="text" id="task-input" class="task-form__input" placeholder="Enter a new task...">
                                <div class="task-form__input-actions">
                                    <select id="priority-select" class="task-form__priority">
                                        <option value="medium">Medium Priority</option>
                                        <option value="low">Low Priority</option>
                                        <option value="high">High Priority</option>
                                    </select>
                                    <button type="submit" class="btn btn--primary task-form__submit">Add Task</button>
                                </div>
                            </div>
                        </div>
                        <div id="task-input-error" class="task-form__error" role="alert"></div>
                    </form>
                </section>
                
                <section class="task-list-section">
                    <div class="task-list-header">
                        <h2 class="task-list-heading">
                            Your Tasks
                            <span class="task-count">(<span data-count="total">0</span> tasks)</span>
                        </h2>
                    </div>
                    
                    <div class="task-list-container">
                        <ul class="task-list" id="task-list" role="list"></ul>
                        <div class="empty-state" id="empty-state">
                            <h3>No tasks yet</h3>
                            <p>Add your first task above to get started!</p>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Load all JavaScript modules -->
    <script type="module" src="js/constants/events.js"></script>
    <script type="module" src="js/constants/selectors.js"></script>
    <script type="module" src="js/utils/helpers.js"></script>
    <script type="module" src="js/utils/validation.js"></script>
    <script type="module" src="js/utils/dateUtils.js"></script>
    <script type="module" src="js/modules/stateManager.js"></script>
    <script type="module" src="js/modules/storage.js"></script>
    <script type="module" src="js/modules/taskManager.js"></script>
    <script type="module" src="js/components/TaskForm.js"></script>
    <script type="module" src="js/components/TaskItem.js"></script>
    <script type="module" src="js/components/TaskList.js"></script>
    <script type="module" src="js/components/Search.js"></script>
    <script type="module" src="js/components/Filter.js"></script>
    <script type="module" src="js/app.js"></script>

    <!-- Test functionality script -->
    <script src="test-functionality.js"></script>

    <script>
        // Test panel functionality
        document.getElementById('toggle-panel').addEventListener('click', function() {
            const panel = document.getElementById('test-panel');
            panel.classList.toggle('hidden');
        });

        document.getElementById('refresh-test').addEventListener('click', function() {
            location.reload();
        });

        // Update test panel with results
        function updateTestPanel() {
            if (!window.testResults) {
                setTimeout(updateTestPanel, 500);
                return;
            }

            const results = window.testResults;
            
            // Core functionality
            document.getElementById('core-tests').innerHTML = [
                createTestItem('App Loaded', results.appLoaded),
                createTestItem('localStorage Available', results.localStorageAvailable),
            ].join('');

            // Storage info
            const storageInfo = `
                <div class="storage-info">
                    <strong>Tasks in Storage:</strong> ${results.tasksInStorage.length}<br>
                    ${results.tasksInStorage.length > 0 ? 
                        results.tasksInStorage.map(task => `• ${task.title || task.text || 'Untitled'}`).join('<br>') 
                        : 'No tasks found'
                    }
                </div>
            `;
            document.getElementById('storage-tests').innerHTML = storageInfo;

            // UI Components
            document.getElementById('ui-tests').innerHTML = [
                createTestItem('Form Elements', results.formExists),
                createTestItem('Search Input', results.searchExists),
                createTestItem('Filter Buttons', results.filterExists),
            ].join('');

            // Task operations
            document.getElementById('task-tests').innerHTML = [
                createTestItem('Can Add Tasks', results.canAddTask),
                createTestItem('Task Count Updates', results.taskCountUpdates),
            ].join('');

            // Errors
            if (results.errors.length > 0) {
                document.getElementById('errors-section').style.display = 'block';
                document.getElementById('error-list').innerHTML = 
                    results.errors.map(error => `<li>${error}</li>`).join('');
            }
        }

        function createTestItem(label, status) {
            let statusClass = 'status-fail';
            let statusIcon = '✗';
            
            if (status === true) {
                statusClass = 'status-pass';
                statusIcon = '✓';
            } else if (status === null || status === undefined) {
                statusClass = 'status-warn';
                statusIcon = '?';
            }
            
            return `
                <div class="test-item">
                    <span class="status-icon ${statusClass}">${statusIcon}</span>
                    <span>${label}</span>
                </div>
            `;
        }

        // Start monitoring for test results
        setTimeout(updateTestPanel, 1000);
        setInterval(updateTestPanel, 2000);
    </script>
</body>
</html>